<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="%if;(cgi)%bvar.static_path;%end;css/fanchart.css">
</head>

%define;somebody_fanchart_info(xx)
"S%xx.anc_sosa.v;":{"fn":"%xx.first_name","sn":"%xx.surname","oc":"%xx.occ","dates":'%xx.dates;',"birth_place":"%xx.birth_place;","death_place":"%xx.death_place","death_age":"%xx.death_age"
  %if;xx.is_male;
    %foreach;ancestor.family;
      %if;(family.index = ancestor.family.index)
        ,"marriage_date":"%marriage_date.year","marriage_place":"%marriage_place"
      %end;
    %end;
  %end;
},
%end;
%define;somebody_fanchart_same(xx)
"S%xx.anc_sosa.v;":{"fn":"=","sn":"%xx.same","oc":"","dates":""},
%end;

<body id="body">
<div id="places" class="none"><ul id="places_list"></ul></div>
<div id="buttons">
<span id="refresh" class="button" title="Ajuster à la fenêtre">&#x21bb;</span><br>
<span id="zoom-in" class="button" title="Zoomer">&#x1f50e;</span><br>
<span id="zoom-out" class="button" title="Dézoomer">&#x1f50d;</span><br>
<span id="places-tools" class="button" title="Afficher/masquer boîte de colorisation des lieux">&#x1f310;</span><br>
<span id="places-colors" class="button" title="Activer/désactiver colorisation globale des lieux">&#x1f3a8;</span><br>
<span id="death-age" class="button" title="Activer/désactiver la colorisation de l'âge de décès">&#x271d;</span><br>
</div>
<svg id="fanchart" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"></svg>
</body>

<script>
var link_to_person = "%prefix;";
var link_to_fanchart = "%prefix;m=A&t=FC&";
var max_gen = %evar.v;;

var ancestor = {
%foreach;ancestor_level(evar.v)
  %foreach;ancestor;
    %if;(ancestor.same = "")
      %apply;somebody_fanchart_info("ancestor")
    %else;
      %apply;somebody_fanchart_same("ancestor")
    %end;
  %end;
%end;
};
</script>
<script src="%if;(cgi)%bvar.static_path;%end;js/fanchart.js"></script>
</html>
